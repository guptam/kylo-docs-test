<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.13.1: http://docutils.sourceforge.net/" />
<title></title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<blockquote>
<img alt="image0" src="media/image02.png" style="width: 3.04822in; height: 2.00392in;" /></blockquote>
<p>Kylo</p>
<p>Manual Deployment Guide</p>
<p>December 12, 2016</p>
<p><strong>Table of contents</strong></p>
<p><a class="reference external" href="#preface">*Preface*</a></p>
<p><a class="reference external" href="#audience">*Audience*</a></p>
<p><a class="reference external" href="#_1fob9te">*System Requirements*</a></p>
<p><a class="reference external" href="#_ej4ypcix9vmt">*Kylo Dependencies*</a></p>
<p><a class="reference external" href="#_2r5ztmx56j">*Prerequisites for Installation*</a></p>
<p><a class="reference external" href="#_3znysh7">*Obtaining Documentation and Submitting a Service
Request*</a></p>
<p><a class="reference external" href="#_2et92p0">*Installation Locations*</a></p>
<p><a class="reference external" href="#_5nrxn2z5zuc5">*Installation*</a></p>
<p><a class="reference external" href="#step-1-setup-directory">*Step 1: Setup Directory*</a></p>
<p><a class="reference external" href="#optional---offline-mode">*Optional - Offline Mode*</a></p>
<p><a class="reference external" href="#step-2-create-linux-users-and-groups">*Step 2: Create Linux Users and
Groups*</a></p>
<p><a class="reference external" href="#step-3-install-think-big-services">*Step 3: Install Think Big
Services*</a></p>
<p><a class="reference external" href="#step-4-run-the-database-scripts">*Step 4: Run the database
scripts*</a></p>
<p><a class="reference external" href="#step-5-install-and-configure-elasticsearch">*Step 5: Install and Configure
Elasticsearch*</a></p>
<p><a class="reference external" href="#step-6-install-activemq">*Step 6: Install ActiveMQ*</a></p>
<p><a class="reference external" href="#step-7-install-java-8">*Step 7: Install Java 8*</a></p>
<p><a class="reference external" href="#step-8-install-java-cryptographic-extension">*Step 8: Install Java Cryptographic
Extension*</a></p>
<p><a class="reference external" href="#step-9-install-nifi">*Step 9: Install NiFi*</a></p>
<p><a class="reference external" href="#step-10-set-permissions-for-hdfs">*Step 10: Set Permissions for
HDFS*</a></p>
<p><a class="reference external" href="#step-11-create-a-dropzone-folder-on-the-edge-node-for-file-ingest-for-example">*Step 11: Create a dropzone folder on the edge node for file ingest,
for
example:*</a></p>
<p><a class="reference external" href="#complete-this-step-for-cloudera-installations-only">*Complete this step for Cloudera installations
ONLY*</a></p>
<p><a class="reference external" href="#step-12-edit-the-properties-files">*Step 12: Edit the Properties
Files*</a></p>
<p><a class="reference external" href="#step-13-final-step-start-the-3-think-big-services">*Step 13: Final Step: Start the 3 Think Big
services*</a></p>
<p><a class="reference external" href="#_2xcytpi">*Configuration*</a></p>
<p><a class="reference external" href="#_1ci93xb">*Database Changes*</a></p>
<p><a class="reference external" href="#_3whwml4">*MySQL*</a></p>
<p><a class="reference external" href="#_2bn6wsx">*Postgres*</a></p>
<p><a class="reference external" href="#_qsh70q">*Appendix: Cloudera Configuration File Changes*</a></p>
<div class="section" id="preface">
<h1>Preface</h1>
<p>This document explains how to install each component of the framework
manually. This is useful for when you are installing across multiple
edge nodes. Use this link to the install wizard if you would prefer not
to do the installation manually.</p>
<table border="1" class="docutils">
<colgroup>
<col width="5%" />
<col width="95%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Tip</strong></td>
<td>Many of the steps below are similar to running the wizard-based install. If you want to take advantage of the same scripts as the wizard you can tar up the /opt/thinkbig/setup folder and untar it to a temp directory on each node.</td>
</tr>
</tbody>
</table>
<p>Information on the operation and maintenance of the Kylo solution is
available at
<a class="reference external" href="https://www.thinkbiganalytics.com/kylo/">*https://www.thinkbiganalytics.com/kylo/*</a>.</p>
</div>
<div class="section" id="audience">
<h1>Audience</h1>
<p>This guide provides step-by-step instruction for installing the Kylo
application on your computer. The reader is assumed to be an IT
Administrator knowledgeable of IT terms and trained with the appropriate
skillset.</p>
<p>Refer to the Kylo Operations and Maintenance (O&amp;M) guide for detailed
instruction on how to effectively manage:</p>
<blockquote>
<ul class="simple">
<li>Production processing</li>
<li>Ongoing maintenance</li>
<li>Performance monitoring</li>
</ul>
</blockquote>
<p>Guides on the Continuous Integration and Deployment of Kylo, including
instructions for maintaining, supporting, and using the solution in
day-to-day operational basis, are available at at
<a class="reference external" href="https://www.thinkbiganalytics.com/kylo/">*https://www.thinkbiganalytics.com/kylo/*</a>.</p>
</div>
<div class="section" id="installation-components">
<h1>Installation Components</h1>
<p>Installing Kylo installs the following software:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>Thinkbig Applications: Kylo provides services to produce Hive tables,</dt>
<dd>generate a schema based on data brought into Hadoop, perform
Spark-based transformations, track metadata, monitor feeds and
SLA policies, and to publish to target systems.</dd>
</dl>
</li>
<li>Java 8: Kylo uses the Java 8 development platform.</li>
<li>NiFi: Kylo uses Apache NiFi for orchestrating data pipelines.</li>
<li><dl class="first docutils">
<dt>ActiveMQ: Kylo uses Apache ActiveMQ to manage communications with</dt>
<dd>clients and servers.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Elasticsearch: Kylo uses Elasticsearch, a distributed,</dt>
<dd>multitenant-capable full-text search engine.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="installation-locations">
<h1>Installation Locations</h1>
<p>Installing Kylo installs the following software at these Linux file
system locations:</p>
<ul class="simple">
<li>Thinkbig Applications - /opt/thinkbig</li>
<li>Java 8 - /opt/java/current</li>
<li>NiFi - /opt/nifi/current</li>
<li>ActiveMQ - /opt/activemq</li>
</ul>
</div>
<div class="section" id="elasticsearch-rpm-installation-default-location">
<h1>Elasticsearch - RPM installation default location</h1>
</div>
<div class="section" id="installation">
<h1>Installation</h1>
<p>For each step below you will need to login to your network with root
access permissions. Installation commands will be executed from the
command-line interface (CLI).</p>
</div>
<div class="section" id="step-1-setup-directory">
<h1>Step 1: Setup Directory</h1>
<p>Kylo is most often installed on one edge node. If you are deploying
everything to one node, the setup directory would typically be:</p>
<p>SETUP_DIR=/opt/thinkbig/setup</p>
<p>Sometimes administrators install NiFi on a second edge node to
communicate with a Hortonworks or Cloudera cluster. In this case, copy
the setup folder to nodes that do not have the Think Big applications
installed. In that case, use this SETUP_DIR command:</p>
<p>SETUP_DIR=/tmp/thinkbig-install</p>
</div>
<div class="section" id="optional-offline-mode">
<h1>Optional - Offline Mode</h1>
<p>If an edge node has no internet access, you can generate a TAR file that
contains everything in the /opt/thinkbig/setup folder, including the
downloaded application binaries.</p>
<ol class="loweralpha">
<li><p class="first">Install the Kylo RPM on a node that has internet access.</p>
</li>
<li><p class="first">Run &quot;/opt/thinkbig/setup/generate-offline-install.sh.</p>
</li>
<li><dl class="first docutils">
<dt>Copy the /opt/thinkbig/setup/thinkbig-install.tar file to the node</dt>
<dd><p class="first last">you install the RPM on. This can be copied to a temp directory.
It doesn’t have to be put in the /opt/thinkbig/setup folder.</p>
</dd>
</dl>
</li>
<li><p class="first">Run &quot;tar -xvf thinkbig-install.tar&quot;.</p>
</li>
<li><dl class="first docutils">
<dt>Note the directory name where you untar’d the files. This will be</dt>
<dd><blockquote class="first">
<p>referred to in the rest of the doc by OFFLINE_SETUP_DIR.</p>
</blockquote>
<p class="last">The script will download all application binaries and puts them in
their respective directory in the setup folder. Last it will TAR up
the setup folder.</p>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="step-2-create-linux-users-and-groups">
<h1>Step 2: Create Linux Users and Groups</h1>
<p>Creation of users and groups is done manually because many organizations
have their own user and group management system. Therefore we cannot
script it as part of the RPM install.</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Note:</strong></td>
<td>Each of these should be run on the node on which the software will be installed.</td>
</tr>
</tbody>
</table>
<p>$ useradd -r -m -s /bin/bash nifi</p>
<p>$ useradd -r -m -s /bin/bash thinkbig</p>
<p>$ useradd -r -m -s /bin/bash activemq</p>
<p>Confirm that the above commands created groups as intended by looking at
/etc/group level in the directory. Some operating systems may not create
them by default.</p>
<p>$ cat /etc/group</p>
<p>If the groups are missing, then run the following:</p>
<p>$ groupadd thinkbig</p>
<p>$ groupadd nifi</p>
<p>$ groupadd activemq</p>
</div>
<div class="section" id="step-3-install-think-big-services">
<h1>Step 3: Install Think Big Services</h1>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>Find and download the RPM file from the artifactory and place it on</dt>
<dd>the host linux machine that you want to install Kylo services on.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Note:</strong></td>
<td>To use wget instead, right-click the download link and copy the url.</td>
</tr>
</tbody>
</table>
<blockquote>
<a class="reference external" href="http://52.203.91.75:8080/artifactory/webapp/search/artifact/?7&amp;q=thinkbig-datalake-accelerator">http://52.203.91.75:8080/artifactory/webapp/search/artifact/?7&amp;q=thinkbig-datalake-accelerator</a>
(requires VPN)</blockquote>
<ol class="arabic">
<li><p class="first">Run the Kylo RPM install.</p>
<blockquote>
<p>$ rpm -ivh thinkbig-datalake-accelerator-&lt;version&gt;.noarch.rpm</p>
</blockquote>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Note:</strong></td>
<td>The RPM is hard coded at this time to install to /opt/thinkbig.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="step-4-run-the-database-scripts">
<h1>Step 4: Run the database scripts</h1>
<p>The database scripts will create one schema called &quot;thinkbig&quot; and
install to that schema. Run the following script:</p>
<p>$ &lt;SETUP_DIR&gt;/sql/mysql/setup-mysql.sh [db_host_or_ip] [db_user]
[db_password]</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Note:</strong></td>
<td>The HDP sandbox doesn't have a password set for the root user so you would run &quot;&lt;SETUP_DIR&gt;/sql/mysql/setup-mysql.sh localhost root&quot;.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="step-5-install-and-configure-elasticsearch">
<h1>Step 5: Install and Configure Elasticsearch</h1>
<p>To get Kylo installed and up and running quickly, a script is provided
to stand up a single node Elasticsearch instance. You can also leverage
an existing Elasticsearch instance. For example, if you stand up an ELK
stack you will likely want to leverage the same instance.</p>
<ol class="arabic simple">
<li>Option 1: Install Elasticsearch from our script.</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Note:</strong></td>
<td>The included Elasticsearch script was meant to speed up installation in a sandbox or DEV environment.</td>
</tr>
</tbody>
</table>
<blockquote>
<!--  -->
</blockquote>
<ol class="loweralpha">
<li><p class="first">Online Mode</p>
<blockquote>
<p>$ &lt;SETUP_DIR&gt;/elasticsearch/install-elasticsearch.sh</p>
</blockquote>
</li>
</ol>
<ol class="loweralpha">
<li><p class="first">Offline Mode</p>
<blockquote>
<p>$ &lt;SETUP_DIR&gt;/elasticsearch/install-elasticsearch.sh -o
&lt;SETUP_DIR&gt;</p>
<p>ex.
/tmp/thinkbig-install/setup/elasticsearch/install-elasticsearch.sh
-o /tmp/thinkbig-install/setup</p>
</blockquote>
</li>
</ol>
<ol class="arabic simple">
<li>Option 2: Use an existing Elasticsearch</li>
<li><dl class="first docutils">
<dt>To leverage an existing Elasticsearch instance, you must update all</dt>
<dd>feed templates that you created with the correct Elasticsearch
URL.You can do this by going to the &quot;Additional Properties&quot; tab
for that feed. If you added any re-usable flow templates you will
need to modify the Elasticsearch processors in NiFI.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Tip:</strong></td>
<td>To test that Elasticsearch is running type &quot;curl localhost:9200&quot;. You should see a JSON response.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="step-6-install-activemq">
<h1>Step 6: Install ActiveMQ</h1>
<p>Another script has been provided to stand up a single node ActiveMQ
instance. You can also leverage an existing ActiveMQ instance.</p>
<ol class="arabic">
<li><p class="first">Option 1: Install ActiveMQ from the script</p>
<blockquote>
<p>The included ActiveMQ script was meant to speed up installation in a
sandbox or DEV environment. It is not a production ready
configuration.</p>
</blockquote>
</li>
</ol>
<ol class="loweralpha">
<li><p class="first">Online Mode</p>
<blockquote>
<p>$ /opt/thinkbig/setup/activemq/install-activemq.sh</p>
</blockquote>
</li>
</ol>
<ol class="loweralpha">
<li><p class="first">Offline Mode</p>
<blockquote>
<p>$ &lt;SETUP_DIR&gt;/activemq/install-activemq.sh -o &lt;SETUP_DIR&gt;</p>
<p>ex. /opt/thinkbig/setup/activemq/install-activemq.sh -o
/opt/thinkbig/setup</p>
</blockquote>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Note:</strong></td>
<td>If installing on a different node than NiFi and thinkbig-services you will need to update the following properties:</td>
</tr>
</tbody>
</table>
<ol class="loweralpha">
<li><p class="first">/opt/nifi/ext-config/config.properties</p>
<blockquote>
<p>spring.activemq.broker-url</p>
</blockquote>
</li>
</ol>
<ol class="loweralpha">
<li><p class="first">/opt/thinkbig/thinkbig-services/conf/application.properties</p>
<blockquote>
<p>jms.activemq.broker.url</p>
</blockquote>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Option 2: Leverage an existing ActiveMQ instance</p>
<blockquote>
<p>Update the below properties so that NiFI and thinkbig-services can
communicate with the existing server.</p>
</blockquote>
</li>
</ol>
<ol class="loweralpha">
<li><p class="first">/opt/nifi/ext-config/config.properties</p>
<blockquote>
<p>spring.activemq.broker-url</p>
</blockquote>
</li>
</ol>
<ol class="loweralpha">
<li><p class="first">/opt/thinkbig/thinkbig-services/conf/application.properties</p>
<blockquote>
<p>jms.activemq.broker.url</p>
</blockquote>
</li>
</ol>
<p><strong>Installing on SUSE</strong></p>
<blockquote>
The deployment guide currently addresses installation in a Redhat
based environment. There are a couple of issues installing
Elasticsearch and ActiveMQ on SUSE. Below are some instructions on
how to install these two on SUSE.</blockquote>
<ul>
<li><p class="first"><strong>ActiveMQ</strong></p>
<blockquote>
<p>When installing ActiveMQ, you might see the following error:</p>
<p>ERROR: Configuration variable JAVA_HOME or JAVACMD is not defined
correctly.</p>
<p>(JAVA_HOME='', JAVACMD='java')</p>
<p>This indicates that ActiveMQ isn’t properly using Java as it is set
in the system. To fix this issue, use the following steps to set the
JAVA_HOME directly.</p>
</blockquote>
</li>
</ul>
<ol class="arabic simple">
<li>Edit /etc/default/activemq and set JAVA_HOME at the bottom</li>
<li>Restart ActiveMQ (service activemq restart)</li>
</ol>
<ul>
<li><p class="first"><strong>Elasticsearch</strong></p>
<blockquote>
<p>RPM installation isn’t supported on SUSE. To work around this issue,
we created a custom init.d service script and wrote up a manual
procedure to install Elasticsearch on a single node.</p>
<p><a class="reference external" href="https://www.elastic.co/support/matrix">*https://www.elastic.co/support/matrix*</a></p>
<p>We have created a service script to make it easy to start and stop
Elasticsearch, as well as leverage chkconfig to automatically start
Elasticsearch when booting up the machine. Below are the
instructions on how we installed Elasticsearch on a SUSE box.</p>
</blockquote>
</li>
</ul>
<ol class="arabic simple">
<li>Make sure Elasticsearch service user/group exists</li>
<li>mkdir /opt/elasticsearch</li>
<li>cd /opt/elasticsearch</li>
<li>mv /tmp/elasticsearch-2.3.5.tar.gz</li>
<li>tar -xvf elasticsearch-2.3.5.tar.gz</li>
<li>rm elasticsearch-2.3.5.tar.gz</li>
<li>ln -s elasticsearch-2.3.5 current</li>
<li>cp elasticsearch.yml elasticsearch.yml.orig</li>
<li><dl class="first docutils">
<dt>Modify elasticsearch.yml if you want to change the cluster name. Our</dt>
<dd>copy that is installed the wizard scripts is located in
/opt/thinkbig/setup/elasticsearch</dd>
</dl>
</li>
<li>chown -R elasticsearch:elasticsearch /opt/elasticsearch/</li>
<li><dl class="first docutils">
<dt>vi /etc/init.d/elasticsearch - paste in the values from</dt>
<dd>/opt/thinkbig/setup/elasticsearch/init.d/sles/elasticsearch</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Uncomment and set the java home on line 44 of the init.d file in</dt>
<dd>step #10</dd>
</dl>
</li>
<li>chmod 755 /etc/init.d/elasticsearch</li>
<li>chkconfig elasticsearch on</li>
<li>service elasticsearch start</li>
</ol>
</div>
<div class="section" id="step-7-install-java-8">
<h1>Step 7: Install Java 8</h1>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Note:</strong></td>
<td>If you are installing NiFI and the thinkbig services on two separate nodes , you may need to perform this step on each node.</td>
</tr>
</tbody>
</table>
<p>There are 3 scenarios for configuring the applications with Java 8.</p>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Scenario 1: Java 8 is installed on the system and is already in the</dt>
<dd><blockquote class="first">
<p>classpath.</p>
</blockquote>
<p>In this case you need to remove the default JAVA_HOME used as part
of the install. Run the following script:</p>
<p>For thinkbig-ui and thinkbig-services</p>
<p>$ &lt;SETUP_DIR&gt;/java/remove-default-thinkbig-java-home.sh</p>
<p class="last">To test this you can look at each file referenced in the scripts for
thinkbig-ui and thinkbig-services to validate the 2 lines setting
and exporting the JAVA_HOME are gone.</p>
</dd>
</dl>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Scenario 2: Install Java in the default /opt/java/current location.</p>
<ol class="loweralpha">
<li><dl class="first docutils">
<dt>Install Java 8 - You can modify and use the following script if</dt>
<dd><p class="first last">you want:</p>
</dd>
</dl>
<ol class="loweralpha simple">
<li>Online Mode</li>
</ol>
</li>
</ol>
<blockquote>
<p>$ &lt;SETUP_DIR&gt;/java/install-java8.sh</p>
</blockquote>
</li>
</ol>
<ol class="loweralpha">
<li><p class="first">Offline Mode</p>
<blockquote>
<p>$ &lt;SETUP_DIR&gt;/java/install-java8.sh -o &lt;SETUP_DIR&gt;</p>
<p>ex. /opt/thinkbig/setup/java/install-java8.sh -o /opt/thinkbig/setup</p>
</blockquote>
</li>
</ol>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Scenario 3: Java 8 is installed on the node, but it’s not in the</dt>
<dd><blockquote class="first">
<p>default JAVA_HOME path.</p>
</blockquote>
<p>If you already have Java 8 installed and want to reference that one
one there is a script to remove the existing path and another script
to set the new path for the thinkbig apps.</p>
<p>For thinkbig-ui and thinkbig-services</p>
<p>$ /opt/thinkbig/setup/java/remove-default-thinkbig-java-home.sh</p>
<p class="last">$ /opt/thinkbig/setup/java/change-thinkbig-java-home.sh
&lt;PATH_TO_JAVA_HOME&gt;</p>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="step-8-install-java-cryptographic-extension">
<h1>Step 8: Install Java Cryptographic Extension</h1>
<p>The Java 8 install script above will automatically download and install
the&nbsp;<a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html">*Java Cryptographic
Extension*</a>.
This extension is required to allow encrypted property values in the
Kylo configuration files. If you already have a Java 8 installed on the
system, you can install the Java Cryptographic Extension by running the
following script:</p>
<p>$ &lt;SETUP_DIR&gt;/java/install-java-crypt-ext.sh &lt;PATH_TO_JAVA_HOME&gt;</p>
<p>This script downloads the extension zip file and extracts the
replacement jar files into the JRE security directory
($JAVA_HOME/jre/lib/security). It will first make backup copies of the
original jars it is replacing.</p>
</div>
<div class="section" id="step-9-install-nifi">
<h1>Step 9: Install NiFi</h1>
<p>You can leverage an existing NiFi installation or follow the steps in
the setup directory that are used by the wizard. Note that Java 8 is
required to run NiFi with our customizations. Make sure Java 8 is
installed on the node.</p>
<ol class="arabic">
<li><p class="first">Option 1: Install NiFi from our scripts</p>
<blockquote>
<p>This method downloads and installs NiFi, and also installs and
configures the Think Big specific libraries. This instance of NiFi
is configured to store persistent data outside of the NiFi
installation folder in /opt/nifi/data. This makes it easy to upgrade
since you can change the version of NiFi without migrating data out
of the old version.</p>
</blockquote>
</li>
</ol>
<ol class="loweralpha">
<li><p class="first">Install NiFi</p>
<ol class="loweralpha simple">
<li>Online Mode</li>
</ol>
<blockquote>
<p>$ &lt;SETUP_DIR&gt;/nifi/install-nifi.sh</p>
</blockquote>
</li>
</ol>
<ol class="loweralpha">
<li><p class="first">Offline Mode</p>
<blockquote>
<p>$ &lt;SETUP_DIR&gt;/nifi/install-nifi.sh -o &lt;SETUP_DIR&gt;</p>
</blockquote>
</li>
</ol>
<ol class="loweralpha">
<li><p class="first">Update JAVA_HOME (default is /opt/java/current).</p>
<blockquote>
<p>$ &lt;SETUP_DIR&gt;/java/change-nifi-java-home.sh &lt;path to JAVA_HOME&gt;</p>
</blockquote>
</li>
</ol>
<ol class="loweralpha">
<li><p class="first">Install Think Big specific components.</p>
<blockquote>
<p>$ &lt;SETUP_DIR&gt;/nifi/install-thinkbig-components.sh</p>
</blockquote>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Option 2: Leverage an existing NiFi instance</p>
<blockquote>
<p>In some cases you may have a separate instance of NiFi or
Hortonworks Data Flow you want to leverage. Follow the steps below
to include the Think Big resources.</p>
</blockquote>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Note:</strong></td>
<td>If Java 8 isn't being used for the existing instance then you will be required to change it.</td>
</tr>
</tbody>
</table>
<ol class="loweralpha">
<li><dl class="first docutils">
<dt>Copy the &lt;SETUP_DIR&gt;/nifi/thinkbig- *.nar and thinkbig-spark-</dt>
<dd><p class="first last">*.jar files to the node NiFi is running on. If it’s on the same
node you can skip this step.</p>
</dd>
</dl>
</li>
<li><p class="first">Shutdown the NiFi instance.</p>
</li>
<li><dl class="first docutils">
<dt>Create folders for the jar files. You may choose to store the jars in</dt>
<dd><blockquote class="first">
<p>another location if you want.</p>
</blockquote>
<p class="last">$ mkdir -p &lt;NIFI_HOME&gt;/thinkbig/lib/app</p>
</dd>
</dl>
</li>
</ol>
<ol class="loweralpha">
<li><dl class="first docutils">
<dt>Copy the thinkbig-*.nar files to the &lt;NIFI_HOME&gt;/thinkbig/lib</dt>
<dd><p class="first last">directory.</p>
</dd>
</dl>
</li>
<li><p class="first">Create a directory called &quot;app&quot; in the &lt;NIFI_HOME&gt;/lib directory.</p>
<blockquote>
<p>$ mkdir &lt;NIFI_HOME&gt;/lib/app</p>
</blockquote>
</li>
</ol>
<ol class="loweralpha">
<li><dl class="first docutils">
<dt>Copy the thinkbig-spark-*.jar files to the</dt>
<dd><p class="first last">&lt;NIFI_HOME&gt;/thinkbig/lib/app directory.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Create symbolic links for all of the jars. Below is an example of how</dt>
<dd><blockquote class="first">
<p>to create it for one NAR file and one JAR file. At the time of
this writing there are 8 NAR files and 3 spark JAR files.</p>
</blockquote>
<p>$ ln -s &lt;NIFI_HOME&gt;/thinkbig/lib/thinkbig-nifi-spark-nar-*.nar
&lt;NIFI_HOME&gt;/lib/thinkbig-nifi-spark-nar.nar</p>
<p class="last">$ ln -s
&lt;NIFI_HOME&gt;/thinkbig/lib/app/thinkbig-spark-interpreter-*-jar-with-dependencies.jar
&lt;NIFI_HOME&gt;/lib/app/thinkbig-spark-interpreter-jar-with-dependencies.jar</p>
</dd>
</dl>
</li>
</ol>
<ol class="loweralpha">
<li><dl class="first docutils">
<dt>Modify &lt;NIFI_HOME&gt;/conf/nifi.properties and update the following</dt>
<dd><blockquote class="first">
<p>property. This modifies NiFI to use our custom provenance
repository to send data to the thinkbig-services application.</p>
</blockquote>
<p>nifi.provenance.repository.implementation=com.thinkbiganalytics.nifi.provenance.v2.ThinkbigProvenanceEventRepository</p>
<p class="last">nifi.web.http.port=8079</p>
</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Note:</strong></td>
<td>If you decide to leave the port number set to the current value you must update the &quot;nifi.rest.port&quot; property in the thinkbig-services application.properties file.</td>
</tr>
</tbody>
</table>
<ol class="loweralpha">
<li><dl class="first docutils">
<dt>There is a controller service that requires a MySQL database</dt>
<dd><p class="first last">connection. You will need to copy the MySQL connector jar to a
location on the NiFI node. The pre-defined templates have the
default location set to /opt/nifi/mysql.</p>
</dd>
</dl>
<ol class="loweralpha simple">
<li>Create a folder to store the MySQL jar in.</li>
<li><dl class="first docutils">
<dt>SCP the</dt>
<dd>/opt/thinkbig/thinkbig-services/lib/mysql-connector-java-&lt;version&gt;.jar
to the folder in step #1</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>If you created a folder name other than the /opt/nifi/mysql</dt>
<dd>default folder you will need to update the &quot;MySQL&quot; controller
service and set the new location. You can do this by logging
into NiFi and going to the Controller Services section on the
top right.</dd>
</dl>
</li>
</ol>
</li>
<li><dl class="first docutils">
<dt>Create H2 folder for fault tolerance. If the JMS queue goes down for</dt>
<dd><p class="first last">some reason our custom Provenance library will startup a local H2
database and store provenance events until JMS comes back up.
Once back up, it will send all of the events stored in the
database then shut down the local H2 instance. Below are steps to
configure the H2 folder.</p>
</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="92%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Note:</strong></td>
<td>Right now the plugin is hard coded to use the /opt/nifi/ext-config directory to load the properties file. There is a Jira to address this PC-261.</td>
</tr>
</tbody>
</table>
<ol class="loweralpha">
<li><p class="first">Create the folders.</p>
<blockquote>
<p>$ mkdir /opt/nifi/h2</p>
<p>$ mkdir /opt/nifi/ext-config</p>
</blockquote>
</li>
</ol>
<ol class="loweralpha">
<li><dl class="first docutils">
<dt>SCP the /opt/thinkbig/setup/nifi/config.properties file to the</dt>
<dd><p class="first last">/opt/nifi/ext-config folder.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Change the ownership of the above folders to the same owner that nifi</dt>
<dd><blockquote class="first">
<p>runs under. For example, if nifi runs as the &quot;nifi&quot; user:</p>
</blockquote>
<p>$ chown -R nifi:users /opt/nifi</p>
<p class="last">OPTIONAL: The
/opt/thinkbig/setup/nifi/install-thinkbig-components.sh contains
steps to install NiFi as a service so that NiFi can startup
automatically if you restart the node. This might be useful to add
if it doesn't already exist for the NiFi instance.</p>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="step-10-set-permissions-for-hdfs">
<h1>Step 10: Set Permissions for HDFS</h1>
<p>This step is required on the node that NiFi is installed on to set the
correct permissions for the &quot;nifi&quot; user to access HDFS.</p>
<ol class="arabic">
<li><dl class="first docutils">
<dt>NiFi Node - Add nifi user to the HDFS supergroup or the group defined</dt>
<dd><blockquote class="first">
<p>in hdfs-site.xml, for example:</p>
</blockquote>
<p>Hortonworks</p>
<p>$ usermod -a -G hdfs nifi</p>
<p>Cloudera</p>
<p>$ groupadd supergroup</p>
<p># Add nifi and hdfs to that group:</p>
<p>$ usermod -a -G supergroup nifi</p>
<p class="last">$ usermod -a -G supergroup hdfs</p>
</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Note:</strong></td>
<td>If you want to perform actions as a root user in a development environment, run the below command.</td>
</tr>
</tbody>
</table>
<blockquote>
$ usermod -a -G supergroup root</blockquote>
<ol class="arabic">
<li><dl class="first docutils">
<dt>thinkbig-services node - Add thinkbig user to the HDFS supergroup or</dt>
<dd><blockquote class="first">
<p>the group defined in hdfs-site.xml, for example:</p>
</blockquote>
<p>Hortonworks</p>
<p>$ usermod -a -G hdfs thinkbig</p>
<p>Cloudera</p>
<p>$ groupadd supergroup</p>
<p># Add nifi and hdfs to that group:</p>
<p class="last">$ usermod -a -G supergroup hdfs</p>
</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Note:</strong></td>
<td>If you want to perform actions as a root user in a development environment run the below command.</td>
</tr>
</tbody>
</table>
<blockquote>
$ usermod -a -G supergroup root</blockquote>
<ol class="arabic">
<li><p class="first">For Clusters:</p>
<blockquote>
<p>In addition to adding the nifi/thinkbig user to the supergroup on
the edge node you also need to add the users/groups to the name
nodes on a cluster.</p>
<p>Hortonworks</p>
<p>$ useradd thinkbig</p>
<p>$ useradd nifi</p>
<p>$ usermod -G hdfs nifi</p>
<p>$ usermod -G hdfs thinkbig</p>
<p>Cloudera - &lt;Fill me in after testing &gt;</p>
</blockquote>
</li>
</ol>
</div>
<div class="section" id="step-11-create-a-dropzone-folder-on-the-edge-node-for-file-ingest-for-example">
<h1>Step 11: Create a dropzone folder on the edge node for file ingest, for example:</h1>
<p>Perform the following step on the node on which NiFI is installed:</p>
<blockquote>
<p>$ mkdir -p /var/dropzone</p>
<p>$ chown nifi /var/dropzone</p>
</blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Note:</strong></td>
<td>Files should be copied into the dropzone such that user nifi can read and remove. Do not copy files with permissions set as root.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="complete-this-step-for-cloudera-installations-only">
<h1>Complete this step for Cloudera installations ONLY</h1>
<p>See the appendix section in the deployment guide &quot;Cloudera Configuration
File Changes&quot; link:deployment-guide{outfilesuffix}[Deployment Guide],</p>
</div>
<div class="section" id="step-12-edit-the-properties-files">
<h1>Step 12: Edit the Properties Files</h1>
</div>
<div class="section" id="step-13-final-step-start-the-3-think-big-services">
<h1>Step 13: Final Step: Start the 3 Think Big services</h1>
<p>$ /opt/thinkbig/start-thinkbig-apps.sh</p>
<p>At this point all services should be running.</p>
</div>
</div>
</body>
</html>
